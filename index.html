<!doctype html><html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>TrustEval-Plus</title>
<link rel="stylesheet" href="config/theme.css">
<style>
body{background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0}
header{background:var(--panel);border-bottom:1px solid var(--muted);padding:14px 16px;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
.btn{display:inline-block;padding:8px 12px;border:1px solid var(--muted);border-radius:10px;background:#141617;color:var(--ink);text-decoration:none}
.container{max-width:1100px;margin:0 auto;padding:0 16px}
.small{color:var(--ink-dim);font-size:12px}
table{width:100%;border-collapse:collapse;margin:12px 0;background:var(--card);border:1px solid var(--muted);border-radius:12px;overflow:hidden}
th,td{padding:12px;border-bottom:1px solid var(--muted);vertical-align:top}
thead th{position:sticky;top:0;background:#141617;z-index:2}
tr:hover{background:#16181a}
.badge{display:inline-flex;gap:6px;padding:2px 8px;border-radius:999px;border:1px solid var(--muted);background:#131416;font-size:12px;white-space:nowrap}
.ok{border-color:var(--ok);color:#d7ffe8} .warn{border-color:var(--warn);color:#fff3bf} .err{border-color:var(--err);color:#ffd7d7}
.chev{cursor:pointer;display:inline-flex;align-items:center;gap:6px;white-space:nowrap}
.drawer{display:none;padding:10px;border:1px solid var(--muted);border-radius:10px;background:#121416;margin:8px 0}
.right{text-align:right}
.input{width:100%;padding:10px;border:1px solid var(--muted);border-radius:10px;margin:10px 0 16px;background:#121416;color:#fff}
.meta-kv{display:grid;grid-template-columns:130px 1fr;gap:6px}
</style>
<script>
let runs=[], sortKey=null, sortAsc=true, filterTerm="";
const pct=x=> (x*100).toFixed(1)+'%';
function setSort(map,key){document.querySelectorAll('.sortable').forEach(th=>{th.setAttribute('aria-sort','none'); th.querySelector('.arrow').textContent='↕';});
  const th=document.getElementById(map[key]); if(!th) return; th.setAttribute('aria-sort',sortAsc?'ascending':'descending'); th.querySelector('.arrow').textContent=sortAsc?'▲':'▼';}
function render(){
  const tbody=document.querySelector('tbody');
  const v=runs.filter(r=>{ if(!filterTerm) return true; const hay=(r.run_id+' '+(r.model||'')+' '+Object.values(r.meta||{}).join(' ')).toLowerCase(); return hay.includes(filterTerm); });
  tbody.innerHTML=v.map(R).join('');
  document.querySelectorAll('.chev').forEach(el=>{el.addEventListener('click',()=>{const id=el.dataset.run; const d=document.getElementById('drawer_'+id); const o=d.style.display!=='block'; d.style.display=o?'block':'none'; el.firstChild.textContent=o?'▾':'▸';});});
}
function sortBy(key,map){
  if(sortKey===key) sortAsc=!sortAsc; else {sortKey=key; sortAsc=true;}
  runs.sort((a,b)=>{const A=a[key],B=b[key]; if(typeof A==='number'&&typeof B==='number') return sortAsc?A-B:B-A; return sortAsc?String(A||'').localeCompare(String(B||'')):String(B||'').localeCompare(String(A||''));});
  setSort(map,key); render();
}
function metaBlock(m){ if(!m) return '<div class=small>—</div>'; const rows=['dataset','prompt_cfg','retriever','date','prov'].filter(k=>m[k]).map(k=>'<div class=small><b>'+k+'</b></div><div class=small>'+m[k]+'</div>').join(''); return '<div class="meta-kv">'+rows+'</div>'; }
async function load(){
  const site = await fetch('config/site.json').then(r=>r.json());
  const board = await fetch('leaderboard.json').then(r=>r.json());
  runs = (board.runs||[]).slice();
  document.getElementById('lastUpdated').textContent=board.updated_at||'—';
  const map={"run_id":"th-run_id","model":"th-model"};
  const head=document.getElementById('thead');
  head.innerHTML='<th id=th-run_id class=sortable>Run <span class=arrow>↕</span></th><th id=th-model class=sortable>Model <span class=arrow>↕</span></th>'
    + site.show_columns.filter(k=>k!=='run_id'&&k!=='model').map(k=>'<th id=th-'+k+' class=sortable>'+ (site.labels[k]||k) +' <span class=arrow>↕</span></th>').join('')
    + '<th>Audit</th><th>Report</th>';
  site.show_columns.forEach(k=>{ if(!map[k]) map[k]='th-'+k; });
  window.R = (r)=>{
    const scoreCells = site.show_columns.filter(k=>!['run_id','model'].includes(k)).map(k=>'<td class=right>'+pct(r[k]||0)+'</td>').join('');
    const status=r.audit?.status||'ok'; const badge='badge '+(status==='ok'?'ok':status==='warn'?'warn':'err'); const icon=(status==='ok'?'✓':status==='warn'?'!':'✖');
    return '<tr><td>'+r.run_id+'</td>'
      + '<td><div class=chev data-run="'+r.run_id+'">▸ <span class=small>'+ (r.model||'—') +' · meta</span></div></td>'
      + scoreCells
      + '<td><span class="badge '+badge.split(' ')[1]+'">'+icon+' '+status+'</span></td>'
      + '<td><a href="'+r.report+'">Report</a></td></tr>'
      + '<tr><td colspan="'+(site.show_columns.length+2)+'"><div class=drawer id="drawer_'+r.run_id+'">'
        + '<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px">'
        + '<div><b>Model & run meta</b>'+ metaBlock(r.meta) +'</div>'
        + '<div><b>Retrieval candidates</b><ul class=small>'+ (r.audit?.trail||[]).map(t=>'<li><code>'+t.doc+'</code> · chunk <b>'+t.chunk+'</b> · score '+t.score+'</li>').join('') +'</ul></div>'
        + '<div><b>Citations used</b><ul class=small>'+ (r.audit?.citations||[]).map(c=>'<li><code>'+c+'</code></li>').join('') +'</ul><b>Proof path</b><div class=small>'+ (r.audit?.proof_path||'—') +'</div></div>'
        + '</div></div></td></tr>';
  };
  render();
  Array.from(head.children).forEach(th=>{
    if(!th.classList.contains('sortable')) return;
    const key=Object.entries(map).find(([k,v])=>v===th.id)?.[0]; if(!key) return;
    th.addEventListener('click',()=>sortBy(key,map)); th.tabIndex=0; th.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); sortBy(key,map);} });
  });
  document.getElementById('filter').addEventListener('input', e=>{ filterTerm=(e.target.value||'').toLowerCase(); render(); });
}
window.addEventListener('DOMContentLoaded', load);
</script>
</head><body>
<header>
  <a class="btn" href="https://theoyez.org" target="_blank">theoyez.org</a>
  <nav>
    <a id="sampleReport" class="btn" href="web/compare.html">Compare</a>
    <a class="btn" href="web/how-it-works.html">How it works</a>
    <a class="btn" href="README.md" target="_blank">README</a>
  </nav>
</header>
<div class="container">
  <div class="small" style="margin-top:12px">Audit badges are single-line and accessible. Click “model · meta” to expand details.</div>
  <input id="filter" class="input" placeholder="Filter by run id, model, or meta…">
  <table>
    <thead><tr id="thead"></tr></thead>
    <tbody></tbody>
  </table>
  <p class="small">Updated: <span id="lastUpdated">—</span></p>
</div>
</body></html>
